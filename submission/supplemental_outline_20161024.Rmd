---
title: ""
bibliography:
csl: microbiome.csl
output: 
  pdf_document:
    keep_tex: true
    includes:
      in_header: header.tex
fontsize: 12pt
geometry: margin=1.0in
---

# Differences in the Stool Microbiome Before and After Colorectal Cancer Treatment

\vspace{10mm}

\begin{center}
Marc A Sze, Nielson T Baxter, Mack T Ruffin IV, Mary AM Rogers, and Patrick D Schloss

\vspace{10mm}

Supplemental
\end{center}


\newpage

```{r knitr_settings, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE}

source('../code/functions.R')

loadLibs(c("tidyr", "dplyr", "scales", "knitr", "rmarkdown"))

```



**Table S1: P-values of Differences between Initial and Follow Up Samples for Richness, Shannon Diversity, and Evenness.**

```{r supplemental_table1, echo=FALSE, message=FALSE, warning=FALSE}

alpha_table <- read.csv("../data/process/tables/alpha_table_summary.csv", header = T, stringsAsFactors = F)
supplemental_table1 <- separate(alpha_table, X, c("comparison", "alpha_metric"), sep="_") 

colnames(supplemental_table1) <- c("Comparison", "Alpha Metric", "P-value", "BH Adjusted P-value")

kable(supplemental_table1, format = "markdown", align = 'c', padding = 2)
```


\newpage


**Table S2: Summary of OTUs in both Lesion and Initial/Follow Up Models**

```{r supplemental_table2, echo=FALSE, message=FALSE, warning=FALSE}

common_vars_summary <- read.csv('../data/process/tables/pvalue_IF_lesion_common_imp_vars.csv', header = T, row.names = 1, stringsAsFactors = F)

lesion_top10_varsMDA <- read.csv('../data/process/tables/reduced_lesion_model_top_vars_MDA_Summary.csv', header = T, stringsAsFactors = F)
IF_top10_varsMDA <- read.csv('../data/process/tables/reduced_IF_model_top_vars_MDA_Summary.csv', header = T, stringsAsFactors = F)

# Create selection vector
common_vars <- common_vars_summary$otu

# Create MDA vectors
lesion_MDA <- filter(lesion_top10_varsMDA, variable %in% common_vars) %>% slice(match(common_vars, variable)) %>% select(mean_MDA)

initial_MDA <- filter(IF_top10_varsMDA, variable %in% common_vars) %>% slice(match(common_vars, variable)) %>% select(mean_MDA)

st2 <- select(common_vars_summary, otu) %>% 
  mutate(Tax = gsub("_unclassified", "", common_vars_summary$lowest_ID)) %>% 
  mutate(lesion_MDA = lesion_MDA$mean_MDA) %>% 
  mutate(initial_MDA = initial_MDA$mean_MDA) %>% arrange(desc(lesion_MDA))

colnames(st2) <- c("OTU", "Lowest Taxonomic ID", "Lesion Model MDA", "Initial Model MDA")

kable(st2, format = "markdown", align = 'c', padding = 2)

```


\newpage
\newcommand{\blandscape}{\begin{landscape}}
\newcommand{\elandscape}{\end{landscape}}

\blandscape

**Table S3: Summary of Comparisons based on Chemotherapy or Radiation Received**

```{r supplemental_table3, echo=FALSE, message=FALSE, warning=FALSE}

chemo_rad_summary <- read.csv('../data/process/tables/probs_chemo_rad_pvalue_summary.csv', 
                              header = T, stringsAsFactors = F) %>% filter(X != "chemo_v_rads_IF") %>% 
  separate(X, c("comparison", "variable"), sep = "_") %>% 
  mutate(comparison = ifelse(comparison == "rads" | comparison == "rad", invisible("Radiation"), invisible("Chemotherapy")), 
         variable = c(rep("sobs", 2), rep("Shannon", 2), rep("Evenness", 2), rep("Thetayc", 2), rep("Positive Probability", 4)))


st3 <- cbind(chemo_rad_summary$variable, chemo_rad_summary$comparison, format(chemo_rad_summary$chemo_rad_mean, digits = 1, nsmall = 1), format(chemo_rad_summary$removal_only_mean, digits = 1, nsmall = 1), format(chemo_rad_summary$cr_sd, digits = 1, nsmall = 1), format(chemo_rad_summary$ro_sd, digits = 1, nsmall = 1), format(chemo_rad_summary$pvalue, scientific = TRUE, digits = 2), format(chemo_rad_summary$bh, scientific = TRUE, digits = 2))

colnames(st3) <- c("Variable", "Additive Treatment", "Additive Treatment Mean", "Removal Mean", "Additive Treatment SD", "Removal SD", "P-value", "BH Corrected")

kable(st3, format = "markdown", align = 'c', padding = 2)






```


\elandscape














